
## Netperf测试

192.168.83.238 node1
192.168.83.239 node2
192.168.83.240 node3
192.168.83.241 node4
192.168.83.242 node5
192.168.83.243 node6
192.168.83.244 node7
192.168.83.245 node8


192.168.83.238
192.168.83.239
192.168.83.240
192.168.83.241
192.168.83.242
192.168.83.243
192.168.83.244
192.168.83.245

32B,256B,1K,16K不同分包大小

### 1. TCP_STREAM：tcp 吞吐量测试

controller1
238 testa1
239 testa2
240 testa3
241 testa4

compute1
242 testb1
243 testb2
244 testb3
245 testb4

#### 1组 

nodea1 - nodeb1
netperf -H 192.168.83.238 -l 60 -i 10,2 -I 99,5 -- -m 32B -s 128K -S 128K
netperf -H 192.168.83.238 -l 60 -i 10,2 -I 99,5 -- -m 256B -s 128K -S 128K
netperf -H 192.168.83.238 -l 60 -i 10,2 -I 99,5 -- -m 1K -s 128K -S 128K
netperf -H 192.168.83.238 -l 60 -i 10,2 -I 99,5 -- -m 16K -s 128K -S 128K

结果

[root@host-192-168-83-242 netperf-2.7.0]# netperf -H 192.168.83.238 -l 60 -i 10,2 -I 99,5 -- -m 32B -s 128K -S 128K
MIGRATED TCP STREAM TEST from 0.0.0.0 (0.0.0.0) port 0 AF_INET to 192.168.83.238 () port 0 AF_INET : +/-2.500% @ 99% conf. 
!!! WARNING
!!! Desired confidence was not achieved within the specified iterations.
!!! This implies that there was variability in the test environment that
!!! must be investigated before going further.
!!! Confidence intervals: Throughput      : 7.578%
!!!                       Local CPU util  : 0.000%
!!!                       Remote CPU util : 0.000%

Recv   Send    Send                          
Socket Socket  Message  Elapsed              
Size   Size    Size     Time     Throughput  
bytes  bytes   bytes    secs.    10^6bits/sec  

262144 262144     32    60.00     178.59   

[root@host-192-168-83-242 netperf-2.7.0]# netperf -H 192.168.83.238 -l 60 -i 10,2 -I 99,5 -- -m 256B -s 128K -S 128K
MIGRATED TCP STREAM TEST from 0.0.0.0 (0.0.0.0) port 0 AF_INET to 192.168.83.238 () port 0 AF_INET : +/-2.500% @ 99% conf. 
!!! WARNING
!!! Desired confidence was not achieved within the specified iterations.
!!! This implies that there was variability in the test environment that
!!! must be investigated before going further.
!!! Confidence intervals: Throughput      : 5.481%
!!!                       Local CPU util  : 0.000%
!!!                       Remote CPU util : 0.000%

Recv   Send    Send                          
Socket Socket  Message  Elapsed              
Size   Size    Size     Time     Throughput  
bytes  bytes   bytes    secs.    10^6bits/sec  

262144 262144    256    60.00     845.76 

[root@host-192-168-83-242 netperf-2.7.0]# netperf -H 192.168.83.238 -l 60 -i 10,2 -I 99,5 -- -m 1K -s 128K -S 128K
MIGRATED TCP STREAM TEST from 0.0.0.0 (0.0.0.0) port 0 AF_INET to 192.168.83.238 () port 0 AF_INET : +/-2.500% @ 99% conf. 
Recv   Send    Send                          
Socket Socket  Message  Elapsed              
Size   Size    Size     Time     Throughput  
bytes  bytes   bytes    secs.    10^6bits/sec  

262144 262144   1024    60.00     937.31 


[root@host-192-168-83-242 netperf-2.7.0]# netperf -H 192.168.83.238 -l 60 -i 10,2 -I 99,5 -- -m 16K -s 128K -S 128K
MIGRATED TCP STREAM TEST from 0.0.0.0 (0.0.0.0) port 0 AF_INET to 192.168.83.238 () port 0 AF_INET : +/-2.500% @ 99% conf. 
Recv   Send    Send                          
Socket Socket  Message  Elapsed              
Size   Size    Size     Time     Throughput  
bytes  bytes   bytes    secs.    10^6bits/sec

262144 262144  16384    60.00     937.34 

2组
nodea1 - nodeb1
netperf -H 192.168.83.238 -l 60 -i 10,2 -I 99,5 -- -m 32B -s 128K -S 128K
netperf -H 192.168.83.238 -l 60 -i 10,2 -I 99,5 -- -m 256B -s 128K -S 128K
netperf -H 192.168.83.238 -l 60 -i 10,2 -I 99,5 -- -m 1K -s 128K -S 128K
netperf -H 192.168.83.238 -l 60 -i 10,2 -I 99,5 -- -m 16K -s 128K -S 128K

nodea2 - nodeb2
netperf -H 192.168.83.239 -l 60 -i 10,2 -I 99,5 -- -m 32B -s 128K -S 128K
netperf -H 192.168.83.239 -l 60 -i 10,2 -I 99,5 -- -m 256B -s 128K -S 128K
netperf -H 192.168.83.239 -l 60 -i 10,2 -I 99,5 -- -m 1K -s 128K -S 128K
netperf -H 192.168.83.239 -l 60 -i 10,2 -I 99,5 -- -m 16K -s 128K -S 128K


[root@host-192-168-83-242 netperf-2.7.0]# netperf -H 192.168.83.238 -l 60 -i 10,2 -I 99,5 -- -m 32B -s 128K -S 128K
MIGRATED TCP STREAM TEST from 0.0.0.0 (0.0.0.0) port 0 AF_INET to 192.168.83.238 () port 0 AF_INET : +/-2.500% @ 99% conf. 
Recv   Send    Send                          
Socket Socket  Message  Elapsed              
Size   Size    Size     Time     Throughput  
bytes  bytes   bytes    secs.    10^6bits/sec  

262144 262144     32    60.00     175.61 

[root@host-192-168-83-242 netperf-2.7.0]# netperf -H 192.168.83.238 -l 60 -i 10,2 -I 99,5 -- -m 256B -s 128K -S 128K
MIGRATED TCP STREAM TEST from 0.0.0.0 (0.0.0.0) port 0 AF_INET to 192.168.83.238 () port 0 AF_INET : +/-2.500% @ 99% conf. 
Recv   Send    Send                          
Socket Socket  Message  Elapsed              
Size   Size    Size     Time     Throughput  
bytes  bytes   bytes    secs.    10^6bits/sec  

262144 262144    256    60.00     469.99

[root@host-192-168-83-242 netperf-2.7.0]# netperf -H 192.168.83.238 -l 60 -i 10,2 -I 99,5 -- -m 1K -s 128K -S 128K
MIGRATED TCP STREAM TEST from 0.0.0.0 (0.0.0.0) port 0 AF_INET to 192.168.83.238 () port 0 AF_INET : +/-2.500% @ 99% conf. 
Recv   Send    Send                          
Socket Socket  Message  Elapsed              
Size   Size    Size     Time     Throughput  
bytes  bytes   bytes    secs.    10^6bits/sec  

262144 262144   1024    60.00     470.12 


[root@host-192-168-83-242 netperf-2.7.0]# netperf -H 192.168.83.238 -l 60 -i 10,2 -I 99,5 -- -m 16K -s 128K -S 128K
MIGRATED TCP STREAM TEST from 0.0.0.0 (0.0.0.0) port 0 AF_INET to 192.168.83.238 () port 0 AF_INET : +/-2.500% @ 99% conf. 
Recv   Send    Send                          
Socket Socket  Message  Elapsed              
Size   Size    Size     Time     Throughput  
bytes  bytes   bytes    secs.    10^6bits/sec  

262144 262144  16384    60.00     470.10 

4组
nodea1 - nodeb1
netperf -H 192.168.83.238 -l 60 -i 10,2 -I 99,5 -- -m 32B -s 128K -S 128K
netperf -H 192.168.83.238 -l 60 -i 10,2 -I 99,5 -- -m 256B -s 128K -S 128K
netperf -H 192.168.83.238 -l 60 -i 10,2 -I 99,5 -- -m 1K -s 128K -S 128K
netperf -H 192.168.83.238 -l 60 -i 10,2 -I 99,5 -- -m 16K -s 128K -S 128K

nodea2 - nodeb2
netperf -H 192.168.83.239 -l 60 -i 10,2 -I 99,5 -- -m 32B -s 128K -S 128K
netperf -H 192.168.83.239 -l 60 -i 10,2 -I 99,5 -- -m 256B -s 128K -S 128K
netperf -H 192.168.83.239 -l 60 -i 10,2 -I 99,5 -- -m 1K -s 128K -S 128K
netperf -H 192.168.83.239 -l 60 -i 10,2 -I 99,5 -- -m 16K -s 128K -S 128K

nodea3 - nodeb3
netperf -H 192.168.83.240 -l 60 -i 10,2 -I 99,5 -- -m 32B -s 128K -S 128K
netperf -H 192.168.83.240 -l 60 -i 10,2 -I 99,5 -- -m 256B -s 128K -S 128K
netperf -H 192.168.83.240 -l 60 -i 10,2 -I 99,5 -- -m 1K -s 128K -S 128K
netperf -H 192.168.83.240 -l 60 -i 10,2 -I 99,5 -- -m 16K -s 128K -S 128K

nodea4 - nodeb4
netperf -H 192.168.83.241 -l 60 -i 10,2 -I 99,5 -- -m 32B -s 128K -S 128K
netperf -H 192.168.83.241 -l 60 -i 10,2 -I 99,5 -- -m 256B -s 128K -S 128K
netperf -H 192.168.83.241 -l 60 -i 10,2 -I 99,5 -- -m 1K -s 128K -S 128K
netperf -H 192.168.83.241 -l 60 -i 10,2 -I 99,5 -- -m 16K -s 128K -S 128K


1. UDP_STREAM：udp吞吐量测试


nodea1 - nodeb1
netperf -H 192.168.83.238 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  32B -M 32B -s 128K -S 128K
netperf -H 192.168.83.238 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  256B -M 256B -s 128K -S 128K
netperf -H 192.168.83.238 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  1K -M 1K -s 128K -S 128K
netperf -H 192.168.83.238 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  16K -M 16K -s 128K -S 128K

[root@host-192-168-83-242 netperf-2.7.0]# netperf -H 192.168.83.238 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  32B -M 32B -s 128K -S 128K
MIGRATED UDP STREAM TEST from 0.0.0.0 (0.0.0.0) port 0 AF_INET to 192.168.83.238 () port 0 AF_INET : +/-2.500% @ 99% conf. 
Socket  Message  Elapsed      Messages                
Size    Size     Time         Okay Errors   Throughput
bytes   bytes    secs            #      #   10^6bits/sec

262144      32   60.00     6360378      0      27.14
262144           60.00     6345580             27.07

[root@host-192-168-83-242 netperf-2.7.0]# netperf -H 192.168.83.238 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  256B -M 256B -s 128K -S 128K
MIGRATED UDP STREAM TEST from 0.0.0.0 (0.0.0.0) port 0 AF_INET to 192.168.83.238 () port 0 AF_INET : +/-2.500% @ 99% conf. 
Socket  Message  Elapsed      Messages                
Size    Size     Time         Okay Errors   Throughput
bytes   bytes    secs            #      #   10^6bits/sec

262144     256   60.00     6387774      0     218.04
262144           60.00     6379389            217.75


[root@host-192-168-83-242 netperf-2.7.0]# netperf -H 192.168.83.238 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  1K -M 1K -s 128K -S 128K
MIGRATED UDP STREAM TEST from 0.0.0.0 (0.0.0.0) port 0 AF_INET to 192.168.83.238 () port 0 AF_INET : +/-2.500% @ 99% conf. 
Socket  Message  Elapsed      Messages                
Size    Size     Time         Okay Errors   Throughput
bytes   bytes    secs            #      #   10^6bits/sec

262144    1024   60.00     6337121      0     865.23
262144           60.00     6330279            864.29

[root@host-192-168-83-242 netperf-2.7.0]# netperf -H 192.168.83.238 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  16K -M 16K -s 128K -S 128K
MIGRATED UDP STREAM TEST from 0.0.0.0 (0.0.0.0) port 0 AF_INET to 192.168.83.238 () port 0 AF_INET : +/-2.500% @ 99% conf. 
Socket  Message  Elapsed      Messages                
Size    Size     Time         Okay Errors   Throughput
bytes   bytes    secs            #      #   10^6bits/sec

262144   16384   60.00     5043978      0    11018.72
262144           60.00      438784            958.54


2组
nodea1 - nodeb1
netperf -H 192.168.83.238 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  32B -M 32B -s 128K -S 128K
netperf -H 192.168.83.238 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  256B -M 256B -s 128K -S 128K
netperf -H 192.168.83.238 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  1K -M 1K -s 128K -S 128K
netperf -H 192.168.83.238 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  16K -M 16K -s 128K -S 128K

nodea2 - nodeb2
netperf -H 192.168.83.239 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  32B -M 32B -s 128K -S 128K
netperf -H 192.168.83.239 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  256B -M 256B -s 128K -S 128K
netperf -H 192.168.83.239 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  1K -M 1K -s 128K -S 128K
netperf -H 192.168.83.239 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  16K -M 16K -s 128K -S 128K


4组
nodea1 - nodeb1
netperf -H 192.168.83.238 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  32B -M 32B -s 128K -S 128K
netperf -H 192.168.83.238 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  256B -M 256B -s 128K -S 128K
netperf -H 192.168.83.238 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  1K -M 1K -s 128K -S 128K
netperf -H 192.168.83.238 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  16K -M 16K -s 128K -S 128K

nodea2 - nodeb2
netperf -H 192.168.83.239 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  32B -M 32B -s 128K -S 128K
netperf -H 192.168.83.239 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  256B -M 256B -s 128K -S 128K
netperf -H 192.168.83.239 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  1K -M 1K -s 128K -S 128K
netperf -H 192.168.83.239 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  16K -M 16K -s 128K -S 128K

nodea3 - nodeb3
netperf -H 192.168.83.240 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  32B -M 32B -s 128K -S 128K
netperf -H 192.168.83.240 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  256B -M 256B -s 128K -S 128K
netperf -H 192.168.83.240 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  1K -M 1K -s 128K -S 128K
netperf -H 192.168.83.240 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  16K -M 16K -s 128K -S 128K

nodea4 - nodeb4
netperf -H 192.168.83.241 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  32B -M 32B -s 128K -S 128K
netperf -H 192.168.83.241 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  256B -M 256B -s 128K -S 128K
netperf -H 192.168.83.241 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  1K -M 1K -s 128K -S 128K
netperf -H 192.168.83.241 -l 60 -t UDP_STREAM  -i 10,2 -I 99,5 -- -m  16K -M 16K -s 128K -S 128K





















nodea1 - nodeb1


nodea2 - nodeb2

tcp_command=(
"netperf -H 192.168.83.238 -l 60 -i 10,2 -I 99,5 -- -m 32B -s 128K -S 128K"
"netperf -H 192.168.83.238 -l 60 -i 10,2 -I 99,5 -- -m 256B -s 128K -S 128K"
"netperf -H 192.168.83.238 -l 60 -i 10,2 -I 99,5 -- -m 1K -s 128K -S 128K"
"netperf -H 192.168.83.238 -l 60 -i 10,2 -I 99,5 -- -m 16K -s 128K -S 128K"
"netperf -H 192.168.83.239 -l 60 -i 10,2 -I 99,5 -- -m 32B -s 128K -S 128K"
"netperf -H 192.168.83.239 -l 60 -i 10,2 -I 99,5 -- -m 256B -s 128K -S 128K"
"netperf -H 192.168.83.239 -l 60 -i 10,2 -I 99,5 -- -m 1K -s 128K -S 128K"
"netperf -H 192.168.83.239 -l 60 -i 10,2 -I 99,5 -- -m 16K -s 128K -S 128K"
)

ips=(
192.168.83.242
192.168.83.243
)

for i in `seq 1 4`
do
{
    for j in `seq 1 2`
    do
    {
        #ssh root@{$ips[$j]} {$tcp_command[$i*$j-1]}
        echo {$tcp_command[$i*$j-1]}
        echo {$ips[$j]}
        sleep 5
    }&
    wait
}
