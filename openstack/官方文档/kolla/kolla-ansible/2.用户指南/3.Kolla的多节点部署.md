#　Kolla的多节点部署

## 部署一个registry

Docker registry是一个本地托管的registry，它代替了从Docker Hub获取镜像的需要。Kolla可以使用本地registry，也可以不使用本地registry，但是对于多节点部署，必须使用某种类型的registry。必须只部署一个registry，尽管registry服务具有HA特性。

2.3版本之前的Docker registry的性能非常糟糕，因为所有的容器数据都是针对每个镜像进行推送的，而不是利用Docker分层来优化推送操作。有关更多信息，请参考pokey registry。

编辑/etc/kolla/globals.yml，并加入以下文字 其中192.168.1.100是机器的IP地址，5000是注册表当前运行的端口:

    docker_registry = 192.168.1.100:5000

Kolla社区建议使用registry 2.3或更高版本。要在2.3版或更高版本中部署registry，请执行以下操作:
    cd kolla
    tools/start-registry

Docker registry可以配置为一个拉取式缓存来代理Docker Hub中托管的官方Kolla镜像。为了将本地注册表配置为拉取式缓存，在主机中将环境变量registry PROXY REMOTEURL设置为Docker Hub上存储库的URL。
    
    export REGISTRY_PROXY_REMOTEURL=https://registry-1.docker.io

不支持将数据push到被设置为拉取式缓存的registry。有关更多信息，请参考Docker文档。