# 准备工作

### 配置源

```
# CentOS-Base.repo
#
# The mirror system uses the connecting IP address of the client and the
# update status of each mirror to pick mirrors that are updated to and
# geographically close to the client.  You should use this for CentOS updates
# unless you are manually picking other mirrors.
#
# If the mirrorlist= does not work for you, as a fall back you can try the
# remarked out baseurl= line instead.
#
#


[base]
name=CentOS-$releasever - Base
baseurl=https://mirrors.tuna.tsinghua.edu.cn/centos-altarch/$releasever/os/$basearch/
#mirrorlist=http://mirrorlist.centos-altarch.org/?release=$releasever&arch=$basearch&repo=os
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-7

#released updates
[updates]
name=centos-altarch-$releasever - Updates
baseurl=https://mirrors.tuna.tsinghua.edu.cn/centos-altarch/$releasever/updates/$basearch/
#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=updates
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-7



#additional packages that may be useful
[extras]
name=CentOS-$releasever - Extras
baseurl=https://mirrors.tuna.tsinghua.edu.cn/centos-altarch/$releasever/extras/$basearch/
#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=extras
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-7



#additional packages that extend functionality of existing packages
[centosplus]
name=CentOS-$releasever - Plus
baseurl=https://mirrors.tuna.tsinghua.edu.cn/centos-altarch/$releasever/centosplus/$basearch/
#mirrorlist=http://mirrorlist.centos.org/?release=$releasever&arch=$basearch&repo=centosplus
gpgcheck=1
enabled=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-7
```

```
# epel.repo
[epel]
name=Extra Packages for Enterprise Linux 7 - $basearch
baseurl=https://mirrors.tuna.tsinghua.edu.cn/epel/7/$basearch
#mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-7&arch=$basearch
failovermethod=priority
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7

[epel-debuginfo]
name=Extra Packages for Enterprise Linux 7 - $basearch - Debug
baseurl=https://mirrors.tuna.tsinghua.edu.cn/epel/7/$basearch/debug
#mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-debug-7&arch=$basearch
failovermethod=priority
enabled=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7
gpgcheck=1

[epel-source]
name=Extra Packages for Enterprise Linux 7 - $basearch - Source
baseurl=https://mirrors.tuna.tsinghua.edu.cn/epel/7/SRPMS
#mirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-source-7&arch=$basearch
failovermethod=priority
enabled=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7
gpgcheck=1
```

分发到所有节点
scp /etc/yum.repos.d/CentOS-Base.repo root@compute2:/etc/yum.repos.d/CentOS-Base.repo
scp /etc/yum.repos.d/epel.repo root@compute2:/etc/yum.repos.d/epel.repo

然后每个节点执行
`yum clean all`
`yum makecache`

## 安装基础包
yum install net-tools -y
yum install vim -y

第一张网卡作为管理网 （management）

第二章网卡作为外部网络 （provider）
修改下列key值

```
DEVICE=INTERFACE_NAME
TYPE=Ethernet
ONBOOT="yes"
BOOTPROTO="none"
```

## 配置无密码登录

## hosts

## hostsname

## 关闭防火墙和selinux

`sudo systemctl stop firewalld` 临时关闭
`sudo systemctl disable firewalld` 然后reboot 永久关闭
`sudo systemctl status  firewalld` 查看防火墙状态。

`sed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config`
`setenforce 0`

## 时间同步（chronyd）

在所有节点中安装chrony
yum install chrony -y

controller1中
vim /etc/chrony.conf
注释掉所有类似下面这行的所有行

server 0.centos.pool.ntp.org iburst 

添加这一行
server ntp1.aliyun.com iburst

allow 10.10.16.55/24
allow 10.10.16.56/24
allow 10.10.16.58/24
allow 10.10.16.59/24
allow 10.10.16.94/24


在controller2
vim /etc/chrony.conf
修改下面这一行
server controller1 iburst

拷贝到其他节点
scp /etc/chrony.conf root@controller2:/etc/chrony.conf
scp /etc/chrony.conf root@compute1:/etc/chrony.conf
scp /etc/chrony.conf root@compute2:/etc/chrony.conf

最后所有节点（要先在controller1上执行）
`systemctl enable chronyd.service`
`systemctl restart chronyd.service`
`chronyc sources` 同步时间

```
ssh root@controller1 "systemctl enable chronyd.service;systemctl restart chronyd.service;chronyc sources"
ssh root@controller2 "systemctl enable chronyd.service;systemctl restart chronyd.service;chronyc sources"
ssh root@controller3 "systemctl enable chronyd.service;systemctl restart chronyd.service;chronyc sources"
ssh root@compute1 "systemctl enable chronyd.service;systemctl restart chronyd.service;chronyc sources"
ssh root@compute2 "systemctl enable chronyd.service;systemctl restart chronyd.service;chronyc sources"
```


## 网络配置

```shell
sed -i 's/BOOTPROTO=.*$/BOOTPROTO=static/' /etc/sysconfig/network-scripts/ifcfg-enahisic2i3

sed -i 's/ONBOOT=no/ONBOOT=yes/' /etc/sysconfig/network-scripts/ifcfg-enahisic2i3

cat << EOF >> /etc/sysconfig/network-scripts/ifcfg-enahisic2i3
IPADDR=172.168.100.55
PREFIX=24
GATEWAY=172.168.100.254
EOF

systemctl restart network

ifconfig
```
