## 安装依赖

在所有节点上安装
yum install epel-release -y
yum install python-pip -y
pip install -U pip

yum install python-devel libffi-devel gcc openssl-devel libselinux-python -y

yum install ansible -y

vim /etc/ansible/ansible.cfg
```
[defaults]
host_key_checking=False
pipelining=True
forks=100
```

## 安装kolla-ansible

pip install kolla-ansible

cp -r /usr/share/kolla-ansible/etc_examples/kolla /etc/kolla/

cd /etc/kolla

cp /usr/share/kolla-ansible/ansible/inventory/* .

## 初始设置

### Inventory

vim multinode

```
[control]
controller1
controller2
controller3

[network]
controller1
controller2
controller3

[compute]
controller1
controller2
controller3
compute1
compute2

[monitoring]
controller1
controller2
controller3

[storage]
controller1
controller2
controller3
compute1
compute2


```

生成随机密码
kolla-genpwd

vim globals.yml

```
kolla_install_type: "source"
openstack_release: "queens"
kolla_internal_vip_address: "10.10.16.224"
network_interface: "enahisic2i0"
neutron_external_interface: "enahisic2i1"
neutron_vlan_interface: "enahisic2i2"
network_vlan_ranges: "2:4096"
tenant_network_types: "vlan"
enable_haproxy: "yes"
enable_keepalived: "{{ enable_haproxy | bool }}"
enable_keystone: "{{ enable_openstack_core | bool }}"
enable_mariadb: "yes"
enable_memcached: "yes"
enable_neutron: "{{ enable_openstack_core | bool }}"
enable_nova: "{{ enable_openstack_core | bool }}"
enable_rabbitmq: "{{ 'yes' if om_rpc_transport == 'rabbit' or om_notify_transport == 'rabbit' else 'no' }}"
enable_cinder: "yes"
glance_backend_file: "yes"
om_rpc_transport: "rabbit"
enable_openstack_core: "yes"
enable_horizon: "{{ enable_openstack_core | bool }}"
enable_glance: "{{ enable_openstack_core | bool }}"
enable_etcd: "yes"
enable_cinder_backend_ceph = "yes"
```

## 部署

kolla-ansible -i ./multinode bootstrap-servers

kolla-ansible -i ./multinode prechecks

kolla-ansible -i ./multinode deploy

deploy出错后 清理环境
kolla-ansible -i ./multinode destroy


## 问题解决记录

4369端口被占用

killall epmd

ps -ef | grep epmd



[WARNING]: Invalid characters were found in group names but not replaced, use -vvvv to see details

 [WARNING]: While constructing a mapping from /etc/kolla/globals.yml, line 18, column 1, found a duplicate dict key (ceph_cinder_keyring). Using last defined value only.