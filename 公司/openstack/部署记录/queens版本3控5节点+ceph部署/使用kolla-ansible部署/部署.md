## 安装依赖

在所有节点上安装
yum install epel-release -y
yum install python-pip -y
pip install -U pip

yum install python-devel libffi-devel gcc openssl-devel libselinux-python -y

yum install ansible -y

vim /etc/ansible/ansible.cfg
```
[defaults]
host_key_checking=False
pipelining=True
forks=100
```

## 安装kolla-ansible

pip install kolla-ansible

cp -r /usr/share/kolla-ansible/etc_examples/kolla /etc/kolla/

cd /etc/kolla

cp /usr/share/kolla-ansible/ansible/inventory/* .

## 初始设置

### Inventory

vim multinode

```
[control]
controller1
controller2
controller3

[network]
controller1
controller2
controller3

[compute]
controller1
controller2
controller3
compute1
compute2

[monitoring]
controller1
controller2
controller3

[storage]
controller1
controller2
controller3
compute1
compute2


```

生成随机密码
kolla-genpwd

vim globals.yml

```
kolla_install_type: "binary"
openstack_release: "queens"
kolla_internal_vip_address: "10.10.16.224"
om_rpc_transport: "rabbit"
network_interface: "enahisic2i0"
neutron_external_interface: "enahisic2i1"
neutron_vlan_interface: "enahisic2i2"
network_vlan_ranges: "2:4096"
tenant_network_types: "vlan"
enable_openstack_core: "yes"
enable_glance: "{{ enable_openstack_core | bool }}"
enable_haproxy: "yes"
enable_keepalived: "{{ enable_haproxy | bool }}"
enable_keystone: "{{ enable_openstack_core | bool }}"
enable_mariadb: "yes"
enable_memcached: "yes"
enable_neutron: "{{ enable_openstack_core | bool }}"
enable_nova: "{{ enable_openstack_core | bool }}"
enable_rabbitmq: "{{ 'yes' if om_rpc_transport == 'rabbit' or om_notify_transport == 'rabbit' else 'no' }}"
enable_central_logging: "yes"
enable_ceph: "no"
enable_chrony: "yes"
enable_cinder: "yes"
ceph_glance_keyring: "ceph.client.glance.keyring"
ceph_glance_user: "glance"
ceph_glance_pool_name: "images"
ceph_cinder_keyring: "ceph.client.cinder.keyring"
ceph_cinder_user: "cinder"
ceph_cinder_pool_name: "volumes"
ceph_cinder_backup_keyring: "ceph.client.cinder-backup.keyring"
ceph_cinder_backup_user: "cinder-backup"
ceph_cinder_backup_pool_name: "backups"
ceph_cinder_keyring: "ceph.client.cinder.keyring"
ceph_nova_keyring: "ceph.client.cinder.keyring"
ceph_nova_user: "nova"
ceph_nova_pool_name: "vms"
enable_etcd: "yes"
enable_horizon: "{{ enable_openstack_core | bool }}"
glance_backend_ceph: "yes"
cinder_backend_ceph: "yes"
nova_backend_ceph: "{{ enable_ceph }}"
nova_compute_virt_type: "kvm"
```

## 部署

kolla-ansible -i ./multinode bootstrap-servers

kolla-ansible -i ./multinode prechecks

kolla-ansible -i ./multinode deploy

deploy出错后 清理环境
kolla-ansible -i ./multinode destroy


## 问题解决记录

### 4369端口被占用

killall epmd

ps -ef | grep epmd


### toolbox服务启不来
因为queens版本的kolla-ansible下载的镜像不支持aarch64平台,故本次部署失败

如何查询版本支持平台
docker logs CONTAINER_ID
出现 standard_init_linux.go:211: exec user process caused "exec format error"

docker inspect IMAGE_ID
打印的详细信息中的Architecture与本平台不符合
 "Architecture": "amd64",

查看本平台
uname -a

注意 amd64 即为X86_64

aarche64 即为arm64
