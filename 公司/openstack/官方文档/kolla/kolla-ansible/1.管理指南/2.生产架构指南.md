#　生产架构指南

本指南将帮助您配置Kolla以适应生产需求。它旨在回答有关Kolla所需的基本配置选项的一些问题。本文档还包含其他有用的指针。


##　节点类型和在其上运行的服务

基本的Kolla清单由几种类型的节点组成，在Ansible中称为 groups。
+ Control - 控制api和数据库等服务的云控制器节点.该组的quorum结点数量应为奇数。
+ Network - 网络节点host Neutron代理和haproxy / keepalived
+ Compute - 计算服务的计算节点,guest VM运行的地方
+ Storage - 存储-cinder-volume，LVM或ceph-osd的存储节点
+ Monitoring - 监视承载监视服务的节点

## 网络配置

### 接口配置

操作者应在kolla中配置以下网络接口

+ network_interface - 虽然不单独使用，但为下面的其他接口提供了必需的默认设置
+ api_interface - 此接口用于管理网络。管理网络是OpenStack服务用来与彼此和数据库进行通信的网络, 这里存在已知的安全风险, 因此建议将该网络设置为内部网络, 而不是从外部进行访问。默认为network_interface。
+ kolla_external_vip_interface - 此接口是面向公众的。当您希望HAProxy端点在内部网络之外的其他网络中公开时，可以使用它。kolla_enable_tls_external设置为yes 时，必须设置此选项 。默认为 network_interface。
+ storage_interface-这是虚拟机用于与Ceph进行通信的接口。这可能会被大量利用，因此建议将该网络置于10Gig网络上。默认为 network_interface。
+ cluster_interface - 这是Ceph使用的另一个接口。用于数据复制。它也可能被大量利用，如果成为瓶颈，可能会影响整个群集的数据一致性和性能。默认为network_interface。
+ neutron_external_interface - Neutron需要此接口。Neutron将把br-ex放在上面。它将用于flast网络以及带tagged VLAN网络。必须单独设置。
+ dns_interface - Designate和Bind9需要此接口。它被公共用来面向bind9和指定的mDNS服务的DNS请求和查询。默认为network_interface。
+ bifrost_network_interface - Bifrost需要此接口。用于提供裸机云主机，需要与裸机云主机进行L2连接，以便为DHCP租约提供PXE引导选项。默认为network_interface。

> Ansible facts 无法识别包含破折号的接口名称，例如，br-ex或bond-0无法使用，因为Ansible会将其分别读取为br_ex和bond_0。

## Docker配置

因为Docker是Kolla的核心依赖项，所以正确配置Docker可以显著地改变Kolla的体验。下一节将重点介绍与Kolla操作者相关的几个Docker配置细节。

### 存储驱动程序

在某些发行版中，Docker存储驱动程序默认为devicemapper，这会严重影响构建和部署的性能。我们建议使用btrfs或aufs作为驱动程序。Docker文档中有关使用哪种存储驱动程序的更多详细信息 。

### 卷
Kolla将几乎所有持久性数据放入Docker卷中。这些卷在Docker工作目录中创建，默认为

    /var/lib/docker

我们建议确保该目录有足够的空间并放置在快速磁盘上，因为它会影响构建，部署以及数据库提交和Rabbitmq的性能。

当enable_central_logging和openstack_logging_debug都设置为true 时， 这尤其重要，因为满载的130个节点群集每天产生30-50GB的日志。