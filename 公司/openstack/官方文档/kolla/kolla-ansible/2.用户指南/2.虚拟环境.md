# 虚拟环境

Python虚拟环境提供了一种将Python包与系统站点包和其他虚拟环境隔离开来的机制。通过在Docker容器中部署服务，Kolla-ansible在很大程度上避免了这个问题，但是一些python依赖项必须安装在Ansible控制主机和目标主机上。

##　Ansible控制主机

kolla-ansible python包及其依赖项可以安装在Ansible control主机上的python虚拟环境中。例如:

    virtualenv /path/to/venv
    source /path/to/venv/bin/activate
    pip install -U pip
    pip install kolla-ansible
    deactivate

也可以在虚拟环境中安装Ansible。

    source /path/to/venv/bin/activate
    (venv) pip install ansible
    (venv) deactivate

要使用虚拟环境，首先要激活它:

    source /path/to/venv/bin/activate
    (venv) kolla-ansible --help

虚拟环境可以在必要时停用:

    (venv) deactivate

请注意，在Ansible control主机上使用虚拟环境并不意味着将使用虚拟环境在目标主机上执行Ansible模块。

## 目标主机

Ansible支持通过ansible_python_interpreter在python虚拟环境中远程执行模块。这可以配置为安装在虚拟环境中的python解释器的路径。例如:

    ansible_python_interpreter: /path/to/venv/bin/python

注意，ansible_python_interpreter不能模板化

Kolla-ansible支持在目标主机上创建python虚拟环境，作为bootstrap-servers命令的一部分。到virtualenv的路径是通过virtualenv变量配置的，而对站点包的访问是通过virtualenv_site_packages控制的。通常，我们需要在这个virtualenv中启用系统站点包，以支持诸如yum、apt和selinux等模块的使用，这些模块在PyPI上是不可用的。

在执行引导服务器以外的kolla-ansible命令时，应该将ansible_python_interpreter设置为安装在virtualenv中的python解释器。